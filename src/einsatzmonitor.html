<!doctype html>
<!--suppress NonAsciiCharacters -->
<html lang="de" class="h-100">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Freiwillige Feuerwehr Ashausen Einsatzmonitor</title>

    <!-- Bootstrap core CSS -->
    <link href="static/bootstrap-4.3.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap colorpicker -->
    <link href="static/css/bootstrap-colorpicker.min.css" rel="stylesheet">

    <!-- noUiSlider -->
    <link href="static/css/nouislider.min.css" rel="stylesheet">
    <link href="static/css/jquery-ui.css" rel="stylesheet">

    <!-- FontAwesome -->
    <link href="static/fontawesome-pro-5.0.13/web-fonts-with-css/css/fontawesome-all.min.css" rel="stylesheet">

    <!-- toastr -->
    <link href="static/css/toastr.min.css" rel="stylesheet">

    <!-- fonts -->
    <link href="static/css/fonts.css" rel="stylesheet">

    <!-- gridster -->
    <link href="static/css/gridster.css" rel="stylesheet">

    <!-- einsatzmonitor -->
    <link href="static/css/einsatzmonitor.css" rel="stylesheet">
</head>

<body class="h-100">

<template id="gridstack-template">
    <li data-bind="attr: { 'id': id, 'data-row': dataRow, 'data-col': dataCol,'data-sizex': datasizex, 'data-sizey': datasizey }" class='gs-w' style='list-style-type: none; background:#99FF99;'>
        <div data-bind="click: removeSelected" style='float:right; cursor: pointer'>X</div>
        <div data-bind='if: state() === "Minimized"'><span data-bind="style:{ 'backgroundColor': color}">-</span></div>
        <div data-bind='if: state() === "Maximized"'><span data-bind="text: value"></span></div>
    </li>
</template>

<template id="clock-widget">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <h1 class="vert-center text-stroke m-0 big-text" data-bind="text: $root.info().parsed_clock, style: { 'color': widget.extra_config.get('text-color') }, class: 'text-' + widget.config.get('align')()"></h1>

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Uhr</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="clockWidgetAlignment" class="mb-1"><Strong>Ausrichtung</Strong></label>
                            <select class="form-control" id="clockWidgetAlignment" data-bind="options: widget.availableAlignments, value: widget.config.get('align')">
                            </select>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="text-widget">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }, css: { 'gs-shadow': widget.extra_config.get('shadow') }" class='gs-w' style='list-style-type: none'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <h1 class="big-text m-0" data-bind="text: widget.extra_config.get('text-title'), style: { 'color': widget.extra_config.get('text-color'), 'font-size': widget.extra_config.get('text-size')() + 'px' }, class: 'text-' + widget.config.get('align')(), css: { 'vert-center': widget.extra_config.get('vert-center') }"></h1>

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Text</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div class="widget-slider" data-field="text-size"></div>
                            <p data-bind="text: widget.extra_config.get('text-size')() + 'px'"></p>

                            <label for="textWidgetTextTitle" class="mb-1"><Strong>Text</Strong></label>
                            <input type="text" class="form-control" id="textWidgetTextTitle" aria-describedby="textWidgetTextTitleHelp" data-bind="value: widget.extra_config.get('text-title'), valueUpdate: 'afterkeydown'">
                            <small id="textWidgetTextTitleHelp" class="form-text text-muted">Text, welcher angezeigt werden soll.</small>

                            <label for="textWidgetAlignment" class="mb-1 mt-3"><Strong>Ausrichtung</Strong></label>
                            <select class="form-control" id="textWidgetAlignment" data-bind="options: widget.availableAlignments, value: widget.config.get('align')"></select>

                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'shadow', description: 'Schatten im Hintergrund' } }"></div>
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'vert-center', description: 'Vertikal zentrieren' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="info-news-widget">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color'), 'padding-left': widget.extra_config.get('padding-x')() + 'px', 'padding-right': widget.extra_config.get('padding-x')() + 'px' }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <h2 class="text-white" data-bind="text: widget.extra_config.get('title')"></h2>

        <div data-bind="foreach: $root.info().sortedNews()">
            <div class="info-card news-wrapper bg-white custom-shadow mb-3">
                <div class="card" style="border: 0; border-radius: 0" data-bind="style: { 'color': widget.extra_config.get('text-color') }">
                    <div class="row no-gutters">
                        <div class="col-md-4">
                            <img style="object-fit: cover; border-radius: 0; height: 100%;" class="card-img" data-bind="attr:{src: image_url()}" alt="">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 data-bind="text: title()" class="card-title"></h5>
                                <p class="card-text" data-bind="html: description_truncated()"></p>
                                <p class="card-text">
                                    <small><i class="far fa-clock"></i></small>
                                    <small class="text-muted" data-bind="text: date_formatted()"></small>
                                    <small class="pull-right text-muted" style="float: right;"><i class="fal fa-external-link"></i> ff-ashausen.de</small>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - News</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="infoNewsWidgetTextTitle" class="mb-1"><Strong>Titel</Strong></label>
                            <input type="text" class="form-control" id="infoNewsWidgetTextTitle" aria-describedby="infoNewsWidgetTextTitleHelp" data-bind="value: widget.extra_config.get('title'), valueUpdate: 'afterkeydown'">
                            <small id="infoNewsWidgetTextTitleHelp" class="form-text text-muted">Titel, der über den News angezeigt werden soll.</small>

                            <div data-bind="template: { name: 'edit-slider', data: { wdg: widget, field: 'padding-x', max: '100', title: 'Padding x', description: 'Abstand links und rechts: ' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="info-dienste-widget">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color'), 'padding-left': widget.extra_config.get('padding-x')() + 'px', 'padding-right': widget.extra_config.get('padding-x')() + 'px' }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <h2 class="text-white" data-bind="text: widget.extra_config.get('title')"></h2>

        <div data-bind="foreach: $root.info().sortedDienste()">
            <div class="dienst-wrapper bg-white shadow mb-2 custom-shadow" data-bind="css: { 'mb-3': is_today() }, style: { 'color': widget.extra_config.get('text-color') }">
                <table class="dienstplan-table" style="width: 100%">
                    <tr class="dienst-entry" data-bind="css: { 'dienst-today': is_today() }">
                        <td>
                            <span class="dienst-date pull-left bg-info">
                                <span class="dienst-date-month text-center text-white" data-bind="text: startDate().toLocaleString('de-de', { month: 'long' }).substring(0, 3)"></span>
                                <span class="dienst-date-day text-center text-white" data-bind="text: startDate().getDate()"></span>
                            </span>
                        </td>
                        <td style="max-width: 0;white-space: nowrap; text-overflow: ellipsis;overflow: hidden;">
                            <span class="pl-2">
                                <i style="font-size: 1.1rem;" class="far fa-clock" aria-hidden="true"></i> <span style="font-size: 1.1rem;" data-bind="text: startUhrzeit()"></span>
                                <strong style="font-size: 1.1rem;"><i class="far fa-clipboard-list pl-2"></i> <span data-bind="text: title()"></span></strong>
                                <span class="ml-2" data-bind="text: description()"></span>
                            </span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Dienste</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="infoDiensteWidgetTextTitle" class="mb-1"><Strong>Titel</Strong></label>
                            <input type="text" class="form-control" id="infoDiensteWidgetTextTitle" aria-describedby="infoDiensteWidgetTextTitleHelp" data-bind="value: widget.extra_config.get('title'), valueUpdate: 'afterkeydown'">
                            <small id="infoDiensteWidgetTextTitleHelp" class="form-text text-muted">Titel, der über den Diensten angezeigt werden soll.</small>

                            <div data-bind="template: { name: 'edit-slider', data: { wdg: widget, field: 'padding-x', max: '100',  title: 'Padding x', description: 'Abstand links und rechts: ' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="info-operations-widget">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color'), 'padding-left': widget.extra_config.get('padding-x')() + 'px', 'padding-right': widget.extra_config.get('padding-x')() + 'px' }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <h2 class="text-white" data-bind="text: widget.extra_config.get('title')"></h2>

        <div data-bind="foreach: $root.info().sortedEinsaetze()">
            <div class="einsaetze-wrapper bg-white mb-2 custom-shadow" style="border: 1px solid #c9c9c9">
                <a data-bind="style: { 'border-left-color': color(), 'color': widget.extra_config.get('text-color')} " class="list-group-item p-2" style="border-left: 6px solid; border-radius: 0; border-top: 0; border-bottom: 0;">
                    <div class="pl-1 mb-0">
                        <small><i class="far fa-clock" aria-hidden="true"></i></small>
                        <small data-bind="text: alarmzeit_formatted()"></small>
                        <br>
                        <p class="m-0" data-bind="text: title()"></p>
                    </div>
                </a>
            </div>
        </div>

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Einsätze</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="infoOperationsWidgetTextTitle" class="mb-1"><Strong>Titel</Strong></label>
                            <input type="text" class="form-control" id="infoOperationsWidgetTextTitle" aria-describedby="infoOperationsWidgetTextTitleHelp" data-bind="value: widget.extra_config.get('title'), valueUpdate: 'afterkeydown'">
                            <small id="infoOperationsWidgetTextTitleHelp" class="form-text text-muted">Titel, der über den Einsätzen angezeigt werden soll.</small>

                            <div data-bind="template: { name: 'edit-slider', data: { wdg: widget, field: 'padding-x', max: '100', title: 'Padding x', description: 'Abstand links und rechts: ' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<!-------------------------------------

          Operation widgets

--------------------------------------->

<template id="operation-stichwort">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <div class="text-center vert-center" data-bind="class: 'text-' + widget.config.get('align')()"> <!-- needs a surrounding div for size calculation because of padding -->
            <h1 class="text-white m-0 fitty-element">
                <!-- ko if: $root.get_latest_einsatz() -->
                <span class="badge p-1 pl-2 pr-2" style="margin-top: -14px; vertical-align: middle;" data-bind="text: $root.get_latest_einsatz().stichwort, class: $root.get_latest_einsatz().stichwort_color_badge"></span>
                <span class="description" data-bind="text: $root.get_latest_einsatz().get_description, style: { 'color': widget.extra_config.get('text-color') }"></span>
                <!-- /ko -->
            </h1>
        </div>

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Stichwort</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'text-fitty', description: 'Textgröße automatisch anpassen' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-address">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="text-center vert-center" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color') }"> <!-- needs a surrounding div for size calculation because of padding -->
            <h2 class="m-0 fitty-element">
                <span><i class="fal fa-map-marker-alt"></i></span>
                <span data-bind="text: $root.get_latest_einsatz().adresse"></span>
                <span data-bind="text: $root.get_latest_einsatz().objekt"></span>
            </h2>
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Adresse</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'text-fitty', description: 'Textgröße automatisch anpassen' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-additionalInformation">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="p-2" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color') }">
            <table>
                <tbody>
                <!-- ko foreach: $root.get_latest_einsatz().zusatzinfos() -->
                <tr>
                    <td><h5><i class="fal fa-comment-alt-lines mr-1"></i> <strong>Zusatzinfo <span data-bind="text: name"></span>:</strong></h5></td>
                    <td class="pl-4"><h5 data-bind="text: value"></h5></td>
                </tr>
                <!-- /ko -->
                <!-- ko if: $root.get_latest_einsatz().alarmzeit_datetime() -->
                <tr>
                    <td><h5><i class="fal fa-clock mr-1"></i> <strong>Alarmzeit:</strong></h5></td>
                    <td class="pl-4"><h5 data-bind="text: $root.get_latest_einsatz().alarmzeit_datetime()"></h5></td>
                </tr>
                <!-- /ko -->
                </tbody>
            </table>
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Zusatzinfos</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-routeInformation">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="p-2 text-center vert-center" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color') }">
            <h5 class="m-0">
                <span><i class="fal fa-route fa-pull-left"></i></span>
                <span data-bind="text: $root.get_latest_einsatz().distDuration()"></span>
                <span><i class="fal fa-clock fa-pull-right"></i></span>
            </h5>
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Strecke und Zeit vom Anfahrtsweg</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-units">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="einsatz-einheiten" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color') }">
            <!-- ko foreach: $root.get_latest_einsatz().get_visible_einheiten_sorted() -->
            <div class="einsatz-einheit bg-dark p-2 mb-1">
                <div class="text-center"> <!-- needs a surrounding div for size calculation because of padding -->
                    <h4 class="text-white m-0 fitty-element">
                        <span data-bind="text: $data"></span>
                    </h4>
                </div>
            </div>
            <!-- /ko -->
            <!-- ko if: $root.get_latest_einsatz().get_invisible_einheiten_count() > 0 -->
            <div class="einsatz-einheit bg-dark p-2 mb-1">
                <div class="text-center"> <!-- needs a surrounding div for size calculation because of padding -->
                    <h4 class="text-warning m-0">
                        + <span data-bind="text: $root.get_latest_einsatz().get_invisible_einheiten_count()"></span> weitere
                    </h4>
                </div>
            </div>
            <!-- /ko -->
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Alarmierte Einheiten</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'text-fitty', description: 'Textgröße automatisch anpassen' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-feedback">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="einsatz-einheiten ml-0 mr-0" style="height: 100%; columns: 2; column-gap: .25rem;" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color'), columns: widget.extra_config.get('columns') }">
            <!-- ko foreach: $root.get_latest_einsatz().get_feedback_persons_sorted() -->
            <!-- ko if: !$data.isHidden(widget, $data.feedback()) -->
            <div class="pl-0 pr-0 pb-1" style="break-inside: avoid; position: relative; float: none;">
                <div class="einsatz-einheit p-1" data-bind="class: $data.get_feedback_color()">
                    <div class=""> <!-- needs a surrounding div for size calculation because of padding -->
                        <h4 class="text-white m-0 fitty-element">
                            <span data-bind="text: $data.name()"></span>

                            <!-- ko if: widget.extra_config.get('show-functions')() -->
                            <div style="font-size: 16px;" class="mt-1">
                                <!-- ko foreach: $data.functions() -->
                                <span class="badge badge-secondary p-1" style="margin-top: -4px; vertical-align: middle;" data-bind="text: $data.name(), class: $data.color()"></span>
                                <!-- /ko -->
                            </div>
                            <!-- /ko -->
                        </h4>
                    </div>
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Rückmeldungen</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'text-fitty', description: 'Textgröße automatisch anpassen' } }"></div>

                            <div class="form-group">
                                <label class="mt-3" for="exampleFormControlSelect1"><strong>Anzahl an Spalten</strong></label>
                                <select class="form-control" id="exampleFormControlSelect1" data-bind="value: widget.extra_config.get('columns')">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                    <option>6</option>
                                </select>
                            </div>

                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'hide-received', description: 'Rückmeldungen mit Status RECEIVED ausblenden' } }"></div>
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'hide-read', description: 'Rückmeldungen mit Status READ ausblenden' } }"></div>
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'hide-yes', description: 'Rückmeldungen mit Status YES ausblenden' } }"></div>
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'hide-no', description: 'Rückmeldungen mit Status NO ausblenden' } }"></div>
                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'hide-absent', description: 'Rückmeldungen mit Status ABSENT ausblenden' } }"></div>

                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'show-functions', description: 'Funktionen anzeigen' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-feedback-count">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <div style="position: absolute; left: 0; /*bottom: 0;*/ z-index: -1000;" class="ml-1 mb-1 mt-1">
            <span class="badge badge-primary p-1 pl-2 pr-2" style="font-size: 18px;" data-bind="text: widget.extra_config.get('function')"></span>
        </div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="einsatz-einheiten ml-0 mr-0" style="position: absolute; bottom: 0; left: 0; right: 0;" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color') }, css: { 'vert-center': widget.extra_config.get('vert-center') }">
            <div class="pl-0" style="/*position: absolute; top: 50%; left: 50%; margin-right: -50%; transform: translate(-50%, -50%);*/">
                <div class="einsatz-einheit">
                    <div class=""> <!-- needs a surrounding div for size calculation because of padding -->
                        <h2 class="text-white m-0" style="line-height: 0.9" data-maxfitty="100" data-bind="style: {'font-size': widget.extra_config.get('text-size')() + 'px', class: 'text-' + widget.config.get('align')()}">
                            <span data-bind="text: $root.get_latest_einsatz().get_function_count(widget.extra_config.get('function')(), 'YES')" class="text-success">20</span>
                            /
                            <span data-bind="text: $root.get_latest_einsatz().get_function_count(widget.extra_config.get('function')(), 'NO')" class="text-danger">10</span>
                        </h2>
                    </div>
                </div>
            </div>
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Anzahl an Rückmeldungen</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="feedbackCountWidgetFunktion" class="mb-1"><Strong>Funktion</Strong></label>
                            <input type="text" class="form-control" id="feedbackCountWidgetFunktion" aria-describedby="feedbackCountWidgetFunktionHelp" data-bind="value: widget.extra_config.get('function'), valueUpdate: 'afterkeydown'">
                            <small id="feedbackCountWidgetFunktionHelp" class="form-text text-muted">Gibt an, für welche Funktion die Anazhl an Rückmeldungen dargestellt werden soll.</small>

                            <div data-bind="template: { name: 'edit-slider', data: { wdg: widget, field: 'text-size', max: '300', title: 'Textgröße', description: 'Textgröße: ' } }"></div>

                            <label for="feedbackCountWidgetAlignment" class="mb-1 mt-3"><Strong>Ausrichtung</Strong></label>
                            <select class="form-control" id="feedbackCountWidgetAlignment" data-bind="options: widget.availableAlignments, value: widget.config.get('align')"></select>

                            <div data-bind="template: { name: 'edit-booleanValue', data: { wdg: widget, value: 'vert-center', description: 'Vertikal zentrieren' } }"></div>

                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-alarmMinutes">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="einsatz-minutes text-center vert-center p-2" data-bind="class: 'text-' + widget.config.get('align')(), style: { 'color': widget.extra_config.get('text-color') }">
            <h1 class="m-0" data-bind="text: $root.get_latest_einsatz().time_since_alarmierung"></h1>
            <h5 class="m-0">Minuten seit Alarmierung</h5>
        </div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Vergangene Minuten seit Alarmierung</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <div data-bind="template: { name: 'edit-backgroundColor', data: { wdg: widget } }"></div>
                            <div data-bind="template: { name: 'edit-textColor', data: { wdg: widget } }"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-overviewMap">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
            <div class="map bg-dark" data-bind="map:$root.get_latest_einsatz().overview_map"></div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Übersichtskarte</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="operation-routeMap">
    <li data-bind="attr: { 'id': id, 'data-row': widget.dataRow, 'data-col': widget.dataCol, 'data-sizex': widget.datasizex, 'data-sizey': widget.datasizey }, style: { 'background-color': widget.extra_config.get('background-color') }" class='gs-w' style='list-style-type: none; overflow: hidden;'>
        <div data-bind="template: { name: 'widget-buttons' }"></div>

        <!-- ko if: $root.get_latest_einsatz() -->
        <div class="map bg-dark" data-bind="map:$root.get_latest_einsatz().route_map"></div>
        <!-- /ko -->

        <div data-bind="attr: { 'id': 'edit-' + id }" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Widget - Karte mit Anfahrtsweg</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">schließen</button>
                    </div>
                </div>
            </div>
        </div>
    </li>
</template>

<template id="widget-buttons">
    <div class="window-buttons-wrapper mr-1 p-1 close-button-wrapper" style="position:fixed; z-index: 100">
        <div class="buttons">
            <button data-bind="click: edit" class="btn btn-sm btn-outline-primary close-button" style="padding: 0 5px; width: 28px;"><i class="fal fa-edit"></i></button>
            <button data-bind="click: removeSelected" class="btn btn-sm btn-outline-danger close-button" style="padding: 0 5px; width: 28px;"><i class="fal fa-trash"></i></button>
        </div>
    </div>
</template>

<template id="edit-backgroundColor">
    <label for="editBackgroundColor" class="mb-1 mt-3"><Strong>Hintergrundfarbe</Strong></label>
    <input type="text" class="form-control widget-colorpicker" id="editBackgroundColor" aria-describedby="editBackgroundColorHelp" data-bind="value: wdg.extra_config.get('background-color')">
    <small id="editBackgroundColorHelp" class="form-text text-muted">Hintergrundfarbe des Widgets.</small>
</template>

<template id="edit-textColor">
    <label for="editTextColor" class="mb-1 mt-3"><Strong>Textfarbe</Strong></label>
    <input type="text" class="form-control widget-colorpicker" id="editTextColor" aria-describedby="editTextColorHelp" data-bind="value: wdg.extra_config.get('text-color')">
    <small id="editTextColorHelp" class="form-text text-muted">Textfarbe des Widgets.</small>
</template>

<template id="edit-booleanValue">
    <div class="form-group mb-0 mt-3">
        <label class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="editBooleanValue" data-bind="checked: wdg.extra_config.get(value)">
            <span class="custom-control-label" data-bind="text: description"></span>
        </label>
    </div>
</template>
<template id="edit-slider">
    <label class="mb-1 mt-3"><Strong data-bind="text: title"></Strong></label>
    <div class="widget-slider" data-bind="attr: { 'data-field': field, 'data-max': max}"></div>
    <small class="form-text text-muted" data-bind="text: description + ' ' + wdg.extra_config.get(field)() + 'px'"></small>
</template>

<div class="container d-flex flex-column h-100 px-0">
    <div class="gridster-test">
        <div class="gridster" id="gridsterInfo">
            <ul class="m-0" data-bind="template: { name: board().templateName, foreach: board().widgets, as: 'widget', afterAdd: board().addGridster, beforeRemove: board().removeGridster }"></ul>
        </div>
    </div>

    <div id="addWidgetModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Widget hinzufügen</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>Info-Widgets</h4>
                    <button class="btn btn-outline-success mt-1" data-bind='click: addInfoClock'><i class="fal fa-plus"></i> Uhr</button>
                    <button class="btn btn-outline-success mt-1" data-bind='click: addInfoText'><i class="fal fa-plus"></i> Text</button>
                    <button class="btn btn-outline-success mt-1" data-bind='click: addInfoNews'><i class="fal fa-plus"></i> News</button>
                    <button class="btn btn-outline-success mt-1" data-bind='click: addInfoDienste'><i class="fal fa-plus"></i> Dienste</button>
                    <button class="btn btn-outline-success mt-1" data-bind='click: addInfoOperations'><i class="fal fa-plus"></i> Einsätze</button>

                    <!-- <button class="btn btn-outline-success mt-1" data-bind='click: serialize'> Serialize </button> -->

                    <h4 class="mt-5">Einsatz-Widgets</h4>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationStichwort'><i class="fal fa-plus"></i> Stichwort</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationAddress'><i class="fal fa-plus"></i> Adresse</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationAdditionalInformation'><i class="fal fa-plus"></i> Zusatzinfos</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationRouteInformation'><i class="fal fa-plus"></i> Route - Informationen</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationUnits'><i class="fal fa-plus"></i> Einheiten</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationFeedback'><i class="fal fa-plus"></i> Rückmeldungen</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationFeedbackCount'><i class="fal fa-plus"></i> Anzahl Rückmeldungen</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationAlarmMinutes'><i class="fal fa-plus"></i> Minuten seit Alarmierung</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationOverviewMap'><i class="fal fa-plus"></i> Karte - Übersicht</button>
                    <button class="btn btn-outline-danger mt-1" data-bind='click: addOperationRouteMap'><i class="fal fa-plus"></i> Karte - Anfahrtsweg</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bind='click: board().openSettingsMenuModal' data-dismiss="modal">Zurück</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsMenuModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Einstellungen</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>Funktionen</h4>

                    <label for="inputAlamosDbId"><strong>Alamos Feedback-ID für Testeinsatz</strong></label>
                    <input type="text" class="form-control mb-2" id="inputAlamosDbId" data-bind="textInput: testeinsatz_fe2_id">

                    <label for="inputAdresse"><strong>Adresse für Testeinsatz</strong></label>
                    <input type="text" class="form-control mb-2" id="inputAdresse" data-bind="textInput: testeinsatz_adresse">
                    <div class="row">
                        <div class="col">
                            <button class="btn btn-warning btn-block" data-bind='click: addTesteinsatz'><i class="fal fa-play"></i> Testeinsatz starten</button>
                        </div>
                        <div class="col">
                            <button class="btn btn-outline-danger btn-block" data-bind='click: clearOperations'><i class="fal fa-stop"></i> Einsatz beenden</button>
                        </div>
                    </div>

                    <h4 class="mt-5">Ansicht</h4>
                    <button class="btn btn-success" data-bind='click: save'><i class="fal fa-save"></i> Widgets dieser Ansicht speichern</button>
                    <button class="btn btn-success mt-2" data-bind='click: load'><i class="fal fa-download"></i> Widgets dieser Ansicht laden</button>

                    <h4 class="mt-5">Widgets</h4>
                    <button class="btn btn-success" data-bind='click: board().openWidgetAddModal' data-dismiss="modal"><i class="fal fa-plus"></i> Widget hinzufügen</button>
                    <button class="btn btn-danger" data-bind='click: clearWidgets'><i class="fal fa-trash"></i> Alle Widgets entfernen</button>

                    <h4 class="mt-5">EinsatzMonitor Einstellungen</h4>
                    <button id="settings-button" class="btn btn-secondary"><i class="fal fa-cogs"></i> Einstellungen öffnen</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
                </div>
            </div>
        </div>
    </div>


    <div class="window-buttons-wrapper version-info mr-2 mb-2 p-1" style="position:fixed; right:0; bottom:0;">
        <small id="app-version" class="text-muted text-white">EinsatzMonitor V0.0.0 Beta</small>
    </div>

    <div class="window-buttons-wrapper version-info mr-2 mb-2 p-1" style="position:fixed; bottom:0; z-index: 1000;">
        <div class="buttons">
            <button class="btn btn-outline-secondary mr-2" style="padding: 0 4px;" data-bind='click: board().openSettingsMenuModal' data-toggle="tooltip" data-placement="top" title="Einstellungen"><i class="fal fa-cogs"></i></button>
        </div>
    </div>

    <div class="window-buttons-wrapper mr-1 p-1 close-button-wrapper" style="position:fixed; right:0; top:0; z-index: 1000;">
        <div class="buttons">
            <button id="console-button" class="btn btn-sm btn-outline-primary console-button" style="padding: 0 5px; width: 28px;"><i class="far fa-terminal"></i></button>
            <button id="toolbar-button" class="btn btn-sm btn-outline-primary toolbar-button" style="padding: 0 5px; width: 28px;"><i class="fal fa-wrench"></i></button>
            <button id="fullscreen-button" class="btn btn-sm btn-outline-primary fullscreen-button" style="padding: 0 5px; width: 28px;"><i class="fal fa-window-restore"></i></button>
            <button id="close-button" class="btn btn-sm btn-outline-danger close-button" style="padding: 0 5px; width: 28px;"><i class="fal fa-times"></i></button>
        </div>
    </div>
</div>

<!-- Insert this line above script imports  -->
<script>
    if (typeof module === 'object') {
        window.module = module;
        module = undefined;
    }

    const settings = require('electron-settings');
    const log = require("electron-log");

    const emitter = require('events').EventEmitter;
    const em = new emitter();
</script>

<script src="static/js/jquery.min.js"></script>
<script type='text/javascript' src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> <!-- need to be loaded before bootstrap -->

<script src="static/js/vendor/popper.min.js"></script>
<script src="static/bootstrap-4.3.1/js/bootstrap.min.js"></script>

<!-- bootstrap colorpicker -->
<script src="static/js/bootstrap-colorpicker.min.js"></script>

<!-- navigo -->
<script src="static/js/navigo-6.0.2.js"></script>

<!-- knockoutjs -->
<script src="static/js/knockout.min.js"></script>

<script type='text/javascript' src="static/js/ko.observableDictionary.js"></script>

<!-- noUiSlider -->
<script type='text/javascript' src="static/js/nouislider.js"></script>

<!-- toastr -->
<script src="static/js/toastr.min.js"></script>

<!-- reconnecting-websocket -->
<script src="static/js/reconnecting-websocket.js"></script>

<!-- fitty -->
<script src="static/js/fitty2.js"></script>

<!-- moment.js -->
<script src="static/js/moment.min.js"></script>

<!-- gridster.js -->
<script src="static/js/gridster.with-extras.js"></script>

<!-- einsatzmonitor -->
<script src="static/js/einsatzmonitor-models.js"></script>
<script src="static/js/einsatzmonitor-events.js"></script>
<script src="static/js/einsatzmonitor.js"></script>

<!-- sentry -->
<!-- Todo: move sentry code to the top -->
<script>
    if (settings.get("sentry.enabled")) {
        let Sentry = require('@sentry/browser');
        Sentry.init({
            dsn: settings.get("sentry.dsn")
        });
    }
</script>

<!-- google maps -->
<script>
    function loadScript() {
        let script = document.createElement('script');
        script.id = "googleMapsAPI";
        script.type = 'text/javascript';
        script.src = 'https://maps.googleapis.com/maps/api/js?key=' + settings.get("googleMapsKey") + '&language=de&region=de';
        document.body.appendChild(script);
        googleLoaded = true;
        log.info("Loaded Google Maps API")
    }

    window.onload = loadScript;

    let refreshTimer = window.setInterval(function () {
        let oldScript = document.getElementById("googleMapsAPI");
        oldScript.parentNode.removeChild(oldScript);
        log.info("Removed old Google Maps API Javascript code");
        loadScript();
    }, 1000 * 60 * 60 * 23);

</script>

<!-- settings menu -->
<script>
    const button = document.getElementById('settings-button');
    button.addEventListener('click', () => {
        createBrowserWindow();
    });

    function createBrowserWindow() {
        const remote = require('electron').remote;
        const BrowserWindow = remote.BrowserWindow;
        const win = new BrowserWindow({
            height: 900,
            width: 900,
            webPreferences: {
                nodeIntegration: true
            },
        });

        win.loadFile('src/settings.html');
    }
</script>

<!-- window buttons -->
<script>
    const close_button = document.getElementById('close-button');
    const fullscreen_button = document.getElementById('fullscreen-button');
    const toolbar_button = document.getElementById('toolbar-button');
    const console_button = document.getElementById('console-button');
    let win = require('electron').remote.getCurrentWindow();

    close_button.addEventListener('click', () => {
        win.close();
    });

    fullscreen_button.addEventListener('click', () => {
        win.setFullScreen(!win.isFullScreen());
    });

    toolbar_button.addEventListener('click', () => {
        win.setMenuBarVisibility(!win.isMenuBarVisible());
    });

    console_button.addEventListener('click', () => {
        win.webContents.openDevTools();
    });

    // Tooltips
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>

<!-- version display -->
<script>
    const version_container = document.getElementById('app-version');
    const appVersion = window.require('electron').remote.app.getVersion();
    const versionString = `EinsatzMonitor V${appVersion} Beta`;

    version_container.innerHTML = versionString;
</script>

<!-- Insert this line after script imports -->
<script>if (window.module) module = window.module;</script>
</body>
</html>
